{% extends 'base.html' %}
{% load static %}
{% load custom_filters %} 

{% block title %}
    {% if paciente %}
        Notas Cl√≠nicas de {{ paciente.perfil.nombre }}
    {% else %}
        Todas Mis Notas Cl√≠nicas
    {% endif %}
{% endblock %}

{% block content %}
<div class="container mt-4">
    
    {% if paciente %}
        <h2 class="mb-4 text-info">üìë Historial Cl√≠nico de: {{ paciente.perfil.nombre }}</h2>
        <p class="lead text-muted">A continuaci√≥n se muestran todas las notas cl√≠nicas asociadas a este paciente.</p>
    {% else %}
        <h2 class="mb-4 text-info">üìë Mis Notas Cl√≠nicas Recientes</h2>
        <p class="lead text-muted">Historial de las √∫ltimas notas cl√≠nicas registradas.</p>
    {% endif %}

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    {% if notas %}
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h5 class="mb-0">Total de Registros: {{ notas|length }}</h5>
            </div>
            <ul class="list-group list-group-flush">
                {% for nota in notas %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        
                        <div>
                            {# T√≠tulo de la Nota #}
                            <strong class="text-primary">
                                Nota Cl√≠nica #{{ nota.cita.pk }} - 
                                {% if not paciente %}{{ nota.paciente.perfil.nombre }} - {% endif %}
                                {{ nota.fecha_creacion|date:"d M Y" }}
                            </strong>
                            <br>
                            {# Resumen del Diagn√≥stico (Primeras 150 letras) #}
                            <small class="text-muted">
                                **Motivo (S):** {{ nota.diagnostico_subjetivo|truncatechars:150 }}
                            </small>
                            <br>
                            <small class="text-success">
                                Cita: {{ nota.cita.fecha_hora_inicio|date:"H:i" }} | Estado: {{ nota.cita.get_estado_display }}
                            </small>
                        </div>

                        {# Botones de Acci√≥n #}
                        <div>
                            <a href="{% url 'evaluaciones:ver_nota_clinica' nota.cita.pk %}" class="btn btn-sm btn-info me-2">
                                <i class="fas fa-eye"></i> Ver Detalle
                            </a>
                            <a href="{% url 'evaluaciones:crear_o_editar_nota_clinica' nota.cita.pk %}" class="btn btn-sm btn-warning">
                                <i class="fas fa-edit"></i> Editar
                            </a>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% else %}
        <div class="alert alert-warning text-center">
            <i class="fas fa-exclamation-triangle"></i> No se encontraron notas cl√≠nicas registradas 
            {% if paciente %}para el paciente **{{ paciente.perfil.nombre }}**{% endif %}.
        </div>
    {% endif %}

    <div class="mt-4">
        <a href="{% url 'citas:kinesiologo_dashboard' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Volver al Dashboard
        </a>
    </div>
</div>
{% endblock %}