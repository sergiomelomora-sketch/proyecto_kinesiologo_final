<!DOCTYPE html>
<html>
<head>
    <title>Detalle de Cita #{{ cita.pk }}</title>
    
    <style>
        /* Estilos CSS */
        body { background-color: white; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; min-height: 100vh; position: relative; }
        .background-curve { position: absolute; bottom: 0; left: 0; width: 100%; height: 60vh; background: linear-gradient(170deg, transparent 50%, #e0f7fa 50%); z-index: -1; }
        .container { max-width: 400px; margin: 0 auto; padding: 15px 10px; position: relative; }
        
        /* CORRECCI√ìN CLAVE: Asegura la visibilidad y posici√≥n de los botones */
        .button-container { 
            position: fixed; 
            top: 15px; 
            right: 15px; 
            z-index: 9999; 
            display: flex; 
            flex-direction: column; 
            align-items: flex-end; 
        }

        .cancel-btn { 
            padding: 6px 12px; 
            font-size: 0.9em; 
            background-color: #ff5252; 
            color: white; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            margin-bottom: 8px; 
        }
        
        .volver-btn { display: block; text-align: center; padding: 6px 12px; font-size: 0.9em; background-color: #607d8b; color: white; text-decoration: none; border-radius: 5px; }
        
        /* Estilos de informaci√≥n */
        .status-badge { padding: 3px 6px; border-radius: 4px; color: white; font-size: 0.85em; }
        .status-cf { background-color: #4caf50; } 
        .status-cl { background-color: #ff5252; } 
        .status-ag { background-color: #00bcd4; } 
        .info-box { background-color: white; border-radius: 12px; padding: 12px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); text-align: center; margin-top: 20px; }
        .icon-text { display: flex; align-items: center; justify-content: center; margin-bottom: 5px; font-size: 0.95em; color: #333; }
        .icon { margin-right: 8px; font-size: 1.3em; color: #00bcd4; }
        .notice-box { margin-top: 15px; padding: 10px; border: 1px solid #00bcd4; background-color: #e0f7fa; border-radius: 8px; text-align: left; display: flex; align-items: flex-start; }
        .notice-icon { margin-right: 6px; font-size: 1.1em; color: #00bcd4; }
        .title-color { color: #00bcd4; }
        .main-title { font-size: 1.3em; margin-bottom: 5px; } 
        .sub-title { font-size: 1em; }
        .box-title { color: #00bcd4; border-bottom: 2px solid #e0f7fa; padding-bottom: 6px; margin-bottom: 10px; font-size: 1.1em;}
        .motivo-box { border: 1px dashed #ccc; padding: 8px; background-color: #fafafa; border-radius: 5px; max-width: 90%; margin: 5px auto; font-size: 0.9em; }
    </style>
</head>
<body>
    
    <div class="background-curve"></div>

    <div class="button-container">
        
        {# L√ìGICA DE CANCELACI√ìN: VISIBILIDAD GARANTIZADA IGNORANDO EL TIEMPO #}
        
        {# Condici√≥n: Solo si eres el due√±o o Superuser #}
        {% if cita.paciente.perfil.user == user or user.is_superuser %}
            
            <form method="POST" action="{% url 'citas:cancelar_cita_paciente' pk=cita.pk %}" style="margin-bottom: 0;">
                
                {% csrf_token %} <button type="submit" 
                        class="cancel-btn"
                        onclick="return confirm('ATENCI√ìN: ¬øEst√°s seguro de cancelar la cita #{{ cita.pk }}? Esta acci√≥n liberar√° el cupo y es irreversible.');">
                    ‚ùå Cancelar Cita
                </button>
            </form>
                
        {% endif %}

        <a href="{% url 'citas:agenda' %}" class="volver-btn">
            ‚¨ÖÔ∏è Volver
        </a>
    </div>

    <div class="container">
        <h1 class="main-title" style="text-align: center; margin-bottom: 5px;">¬°Hola, {{ cita.paciente.perfil.nombre }}!</h1>
        <h2 class="title-color sub-title" style="text-align: center;">¬°Aqu√≠ tienes todos los detalles de la cita!</h2>

        <div class="info-box">
            <p style="font-style: italic; color: #555; margin-bottom: 8px; font-size: 0.8em;">Aseg√∫rate de guardarlos o anotarlos</p>
            <h3 class="box-title" style="text-align: center;">
                Informaci√≥n de Cita
            </h3>

            <div class="icon-text">
                <span class="icon">üë§</span> 
                <span style="font-weight: bold;">Kinesi√≥logo:</span> 
                {{ cita.kinesiologo.perfil.nombre }} {{ cita.kinesiologo.perfil.apellido }} (Kinesi√≥logo)
            </div>

            <div class="icon-text">
                <span class="icon">üìÖ</span> 
                {{ cita.fecha_hora_inicio|date:"l, d M Y" }}&nbsp;a&nbsp;las&nbsp;
                <span style="font-size: 1em; font-weight: bold;">{{ cita.fecha_hora_inicio|time:"H:i" }} hrs</span>
            </div>

            <div style="margin-top: 10px;">
                <p style="font-weight: bold; margin-bottom: 3px; font-size: 0.9em;">Motivo:</p>
                <p class="motivo-box">
                    {{ cita.motivo|default:"No especificado." }}
                </p>
            </div>

            <p style="font-size: 0.9em; font-weight: bold; margin-top: 10px;">
                ESTADO: 
                <span class="status-badge 
                    {% if cita.estado == 'CF' %}status-cf{% endif %}
                    {% if cita.estado == 'CL' %}status-cl{% endif %}
                    {% if cita.estado == 'AG' or cita.estado == 'PEND' or cita.estado == 'PENDIENTE' %}status-ag{% endif %} 
                ">
                {{ cita.get_estado_display|upper }}
                </span>
            </p>
        </div>

        <div class="notice-box">
            <span class="notice-icon">üîî</span> 
            <p style="margin: 0; font-size: 0.85em;">
                Si eres afiliado a <strong>Fonasa</strong>, debes contar con tu bono vigente al momento de la sesi√≥n.
            </p>
        </div>
    </div>
</body>
</html>